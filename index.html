<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=400, initial-scale=0.9">
    <meta name="description" content="Discover the ultimate dining experience at the University of Patras with Estia Patrwn (Εστία Πατρών) - your comprehensive guide to the campus dining hall known as Estia Patra, λέσχη, or εστιατόριο πανεπιστημίου Πατρών. Our page offers detailed insights into daily menus, πρόγραμμα, along with live updates on line size, waiting times (αναμονή εστίας), queue size (ουρά εστίας), and seating capacity, ensuring you make the most of your dining experience. Whether you're planning your next meal or curious about today's special, we provide all the essential information to enhance your dining at Estia Patra. Stay ahead of the crowd with our timely updates and embrace the vibrant culinary culture at the University of Patras.">
    <meta name="theme-color" content="#fd8353">
    <title>University Restaurant Dashboard Patras</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">


    
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo-container">
                <div class="logo">Sense Campus Patras</div>
            </div>
            

        </div>
    </header>
    
    
    <main class="main-content container">
        <div class="main-content"></div>
            <section id="wait-times" class="chart-section">
                <div class="chart-title"></div>
                <h2 style="display: inline-block; vertical-align: middle; padding-left: 15px;">Waiting Area</h2>
                <h2 id="current_WaitTime" class="count" style="display: inline-block; vertical-align: middle; padding-right: 10px; width: 2em; text-align: right;">NaN</h2>
                
                <img class="svg" src="media/users.svg" alt="Crowd Icon" style="display: inline-block; width: 45px; height: 45px; vertical-align: middle; padding-bottom: 8px; padding-right: 5px;">
                    
                </div>
                <div class="chart-container">
                    <canvas id="waitTimeChart"></canvas>
                </div>
            </section>
        
        
            <section id="line-sizes" class="chart-section">
                <div class="chart-title"></div>
                    <h2 style="display: inline-block; vertical-align: middle; padding-left: 15px;">Restaurant</h2>
                    <h2 id="current_LineSize" class="count" style="display: inline-block; vertical-align: middle; padding-right: 15px; width: 2em; text-align: right;">NaN</h2>
                    
                    <img class="svg" src="media/seat.svg" alt="Chair Icon" style="display: inline-block; width: 45px; height: 45px; vertical-align: middle; padding-right: 0px;padding-left: 5px;">
                </div>
                <div class="chart-container">
                    <canvas id="lineSizeChart"></canvas>
                </div>
            </section>

            <section id="restaurant-capacity" class="capacity-section">
                <div class="capacity-title">
                    <h2 style="display: inline-block; vertical-align: middle; padding-left: 5px;">Traffic</h2>
                    <h2 id="current_Capacity" class="count" style="display: inline-block; vertical-align: middle; padding-left: 5px; width: 2em; text-align: right;">NaN</h2> 
                    <img class="svg" src="media/clock.svg" alt="Clock Icon" style="display: inline-block; width: 30px; height: 30px; vertical-align: bottom; padding-bottom: 0px;padding-right: 2px;padding-top: 5px;">
                </div>
                <div class="capacity-container">
                    <div id="capacity-bar" class="capacity-bar"></div>
                </div>
                <div class="capacity-axis">
                    <span>0%</span>
                    <span>25%</span>
                    <span>50%</span>
                    <span>75%</span>
                    <span>100%</span>
                </div>
            </section>
            

            <section id="todays-menu" class="menu-section">
                <h2 class="Menu-Title">&nbsp;Today's Menu</h2>
                <button class="more-btn" id="moreButton">More</button>
                <div class="menu-container">
                    <div id="breakfast-menu" class="menu-item">
                        <h3>Breakfast</h3>
                    </div>
                    <div id="lunch-menu" class="menu-item">
                        <h3>Lunch</h3>
                    </div>
                    <div id="dinner-menu" class="menu-item">
                        <h3>Dinner</h3>
                    </div>
                </div>

            </section>
            
            
        </div>
        

    </main>
    <!-- The Modal -->
    <div id="pdfModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Week's Schedule</h2>
            <!-- Add a link to download the PDF file -->
            <div>
            <br>
            <a id="pdf-download-link" href="" download style="float:right; margin-top: -25px;" class="no-link-style">Download PDF</a>
            </div>
            <canvas id="pdf-canvas" style="padding-left: 350px;"></canvas>
            <div id="pdf-info">
                <span>Week: <span id="week-number"></span></span> / <span id="total-pages"></span> pages.
            </div>
        </div>
    </div>

    <footer class="footer">
 
        <div class="container">
            <p class="contact-info">&copy; SenseCampusPatras. All rights reserved.</p>
            <p class="contact-info" id="contact-info">Contact us: sensecampus@gmail.com</p>
            <div id="last-updated" class="last-updated"></div>
        </div>
    </footer>


    <nav class="bottom-nav">
        <div class="navbar">
            <a href="#home" class="active">Queue</a>
            <a href="#todays-menu">Menu</a>
            <a class="more-butn" role="button" tabindex="0">
                <img src="media/refresh.svg" alt="Refresh Icon" style="width:30px; height:30px;">
                <span id="timer" style="width:35px;">01:00</span>
            </a>
        </div>
    </nav>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            let pdfDoc = null,
                scale = 1.2,
                canvas = document.getElementById('pdf-canvas'),
                ctx = canvas.getContext('2d');

            // Modal related elements
            const modal = document.getElementById('pdfModal');
            const closeModal = document.getElementsByClassName('close')[0];
            const moreButton = document.getElementById('moreButton');
            const downloadLink = document.getElementById('pdf-download-link'); // Download link

            // The URL of the PDF file (update with your actual PDF file URL)
            const pdfUrl = 'programma.pdf';

            // Set the href attribute of the download link to point to the PDF file
            downloadLink.href = pdfUrl;

            // Function to calculate the current week of the month with leap week logic
            const getWeekOfMonth = () => {
                const now = new Date();
                const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                const firstDayOfWeek = firstDayOfMonth.getDay();
                const currentDay = now.getDate();

                const firstMonday = firstDayOfWeek === 1 ? 1 : (8 - (firstDayOfWeek === 0 ? 7 : firstDayOfWeek));

                if (currentDay < firstMonday) {
                    return 1;
                }

                const daysSinceFirstMonday = currentDay - firstMonday;
                const weekNumber = Math.floor(daysSinceFirstMonday / 7) + 2;

                return weekNumber;
            };

            // Load the PDF document
            const loadPDF = async (url) => {
                const loadingTask = pdfjsLib.getDocument(url);
                pdfDoc = await loadingTask.promise;
                document.getElementById('total-pages').textContent = pdfDoc.numPages;

                const weekNumber = getWeekOfMonth();
                const pageNum = Math.min(weekNumber, pdfDoc.numPages);

                document.getElementById('week-number').textContent = pageNum;
                renderPage(pageNum);
            };

            // Render the PDF page
            const renderPage = async (num) => {
                const page = await pdfDoc.getPage(num);
                const viewport = page.getViewport({ scale });
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };

                await page.render(renderContext).promise;
            };

            // Show modal and load the PDF when the "More" button is clicked
            moreButton.onclick = function() {
                modal.style.display = "block";
                loadPDF(pdfUrl); // Load the PDF file
            };

            // Close the modal when the "X" button is clicked
            closeModal.onclick = function() {
                modal.style.display = "none";
            };

            // Close the modal when clicking outside of it
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            };
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/moment"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
    <script type="module" defer src="script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.5.141/pdf.min.js"></script>


</body>
</html>
